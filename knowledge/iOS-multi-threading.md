# 关于 iOS 的多线程
## 一、进程与线程
### [进程](https://zh.wikipedia.org/wiki/%E8%A1%8C%E7%A8%8B)
进程(process)是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体，在当代面向线程设计的计算机结构中，进程是线程的容器，
程序是指令、数据及其组织形式的描述，进程是程序的实体。

简单来说就是：
1. 进程是指在系统中正在运行的一个应用程序
2. 每个进程之间是独立的，每个进程均运行在其专用且受保护的内存空间内
3. 比如同时打开迅雷、Xcode，系统就会分别启动 2 个进程

### [线程](https://zh.wikipedia.org/wiki/%E7%BA%BF%E7%A8%8B)
线程（thread）是组成进程的子单元，操作系统的调度器可以对线程进行单独的调度。实际上，所有的并发编程 API 都是构建于线程之上的 —— 包括 GCD 和操作队列（operation queues）。

简单来说，一个进程要想执行任务，必须得有线程。一个进程中至少包含一条线程，即主线程，创建线程的目的就是为了开启一条新的执行路径，运行指定的代码，与主线程中的代码实现同时运行。
### 进程和线程之间的关系
1. 一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程（通常说的主线程）。   
2. 资源分配给进程，同一进程的所有线程共享该进程的所有资源。    
3. 线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。    
4. 处理机分给线程，即真正在处理机上运行的是线程。    
5. 线程是指进程内的一个执行单元，也是进程内的可调度实体。

### 进程和线程之间的区别
三个角度来看：
1. 调度：线程作为调度和分配的基本单位，进程作为拥有资源的基本单位。
2. 并发性：不仅进程之间可以并发执行，同一个进程的多个线程之间也可以并发执行。
3. 拥有资源：进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源。

### 多线程
多线程（multithreading），是指从软件或者硬件上实现多个线程并发执行的技术。具有多线程能力的计算机因有硬件支持而能够在同一时间执行多于一个线程，进而提升整体处理性能。

多线程可以在单核 CPU 上同时（或者至少看作同时）运行。操作系统将小的时间片分配给每一个线程，这样就能够让用户感觉到有多个任务在同时进行。如果 CPU 是多核的，那么线程就可以真正的以并发方式被执行，从而减少了完成某项操作所需要的总时间。

**多线程原理**
* 同一时间，CPU只能处理1条线程，只有1条线程在工作（执行）
* 多线程并发（同时）执行，其实是CPU快速地在多条线程之间调度（切换）
* 如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象
注意：多线程并发，并不是cpu在同一时刻同时执行多个任务，只是CPU调度足够快，造成的假象

**多线程优点**
* 能适当提高程序的执行效率
* 能适当提高资源利用率（CPU、内存利用率）

**多线程缺点**
* 开启线程需要占用一定的内存空间（默认情况下，主线程占用1M，子线程占用512KB），如果开启大量的线程，会占用大量的内存空间，降低程序的性能
* 线程越多，CPU在调度线程上的开销就越大

### 并行与并发
如果某个系统支持两个或者多个动作（Action）**同时存在** ，那么这个系统就是一个并发系统。如果某个系统支持两个或者多个动作 **同时执行** ，那么这个系统就是一个并行系统。并发系统与并行系统这两个定义之间的关键差异在于 **“存在”** 这个词。
在并发程序中可以同时拥有两个或者多个线程。这意味着，如果程序在单核处理器上运行，那么这两个线程将交替地换入或者换出内存。这些线程是同时“存在”的——每个线程都处于执行过程中的某个状态。如果程序能够并行执行，那么就一定是运行在多核处理器上。此时，程序中的每个线程都将分配到一个独立的处理器核上，因此可以同时运行。
我相信你已经能够得出结论—— **“并行”概念是“并发”概念的一个子集。** 也就是说，你可以编写一个拥有多个线程或者进程的并发程序，但如果没有多核处理器来执行这个程序，那么就不能以并行方式来运行代码。因此，凡是在求解单个问题时涉及多个执行流程的编程模式或者执行行为，都属于并发编程的范畴。
摘自：《并发的艺术》 — 〔美〕布雷谢斯

举个例子：
吃饭的时候先接电话跟后接电话的比较更像是中断优先级高低的不同。

并发应该是一手筷子，一手电话，说一句话，咽一口饭。
并行是咽一口饭同时说一句话，而这光靠一张嘴是办不到的，至少两张嘴。

Reference:
> [并发与并行的区别？](https://www.zhihu.com/question/33515481)

